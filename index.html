<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Terminal Madame Solomi'na</title>
    
    <link rel="manifest" href="./manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Solomi'na">
    <link rel="apple-touch-icon" href="./icon-192.png">
    <meta name="theme-color" content="#3498db">
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@300;400&display=swap" rel="stylesheet">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --bg-color: #f4f7f9;
            --card-bg: #ffffff;
            --text-main: #2c3e50;
            --text-secondary: #7f8c8d;
            --accent-blue: #3498db;
            --accent-green: #2ecc71;
            --accent-yellow: #f1c40f;
            --accent-orange: #e67e22;
            --accent-red: #e74c3c;
            --accent-gradient: linear-gradient(135deg, #3498db, #2980b9);
            --header-gradient: linear-gradient(135deg, #f8f9fa, #e9ecef);
            --header-light-gradient: linear-gradient(135deg, #e3f2fd, #f0f9ff); 
            --graphite-color: #303D4F;
            --input-color: #3a506b;
            --card-shadow: rgba(0,0,0,0.06);
            --border-color: rgba(0,0,0,0.04);
            --item-border: #f0f0f0;
            --nav-bg: rgba(255, 255, 255, 0.95);
            --nav-border: rgba(255, 255, 255, 0.5);
            --nav-icon-inactive: #bdc3c7;
            --coupon-blue-bg: rgba(52, 152, 219, 0.08);
            --badge-blue-bg: rgba(52, 152, 219, 0.15);
            --badge-green-bg: rgba(46, 204, 113, 0.15);
            --brand-color: #333D4D;
            --bg-gradient: linear-gradient(135deg, #F1F6FB 0%, #F9FAFC 100%);
        }
    

        body.dark-mode {
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --text-main: #f1f5f9;
            --text-secondary: #94a3b8;
            --accent-blue: #38bdf8;
            --accent-green: #4ade80;
            --accent-yellow: #fcd34d;
            --accent-orange: #fb923c;
            --accent-red: #f87171;
            --accent-gradient: linear-gradient(135deg, #38bdf8, #0ea5e9);
            --header-gradient: linear-gradient(135deg, #1e293b, #2d3748);
            --header-light-gradient: linear-gradient(135deg, #1e293b, #334155);
            --graphite-color: #303D4F;
            --input-color: #f8fafc;
            --card-shadow: rgba(0,0,0,0.4);
            --border-color: rgba(255,255,255,0.05);
            --item-border: #334155;
            --nav-bg: rgba(30, 41, 59, 0.95);
            --nav-border: rgba(255, 255, 255, 0.1);
            --nav-icon-inactive: #475569;
            --coupon-blue-bg: rgba(56, 189, 248, 0.1);
            --badge-blue-bg: rgba(56, 189, 248, 0.15);
            --badge-green-bg: rgba(74, 222, 128, 0.15);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0; padding: 16px; line-height: 1.4;
            -webkit-tap-highlight-color: transparent;
            padding-bottom: 120px;
            transition: background 0.3s, color 0.3s;
            overflow-x: hidden;
            overscroll-behavior-y: none;
        }

        .toast {
            position: fixed;
            top: 20px; left: 50%; transform: translateX(-50%);
            background: #2ecc71; color: white; padding: 10px 20px; border-radius: 20px;
            font-size: 12px; font-weight: bold;
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
            z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s;
        }
        .toast.show { opacity: 1; visibility: visible; }

        .screen { display: none; animation: fadeIn 0.4s ease; }
        .screen.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .terminal-header { padding: 10px 10px 30px; text-align: left; }
        .terminal-badge {
            display: inline-flex;
            align-items: center; gap: 6px; padding: 4px 10px;
            background: var(--accent-blue); color: white; font-size: 10px; font-weight: 900;
            border-radius: 4px; text-transform: uppercase;
            margin-bottom: 12px; letter-spacing: 1px;
        }

        .market-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; background: #ccc; }
        .dot-online { background: #2ecc71; box-shadow: 0 0 8px #2ecc71; animation: pulse 2s infinite; }
        .dot-offline { background: #e74c3c; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        .home-title { font-size: 26px; font-weight: 800; margin-bottom: 15px; line-height: 1.2; }
        .home-desc { font-size: 15px; color: #8e8e93; line-height: 1.6; margin-bottom: 25px; }
        
        .market-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }
        .market-item-modern {
            background: var(--card-bg);
            border-radius: 16px; padding: 12px 16px;
            position: relative; overflow: hidden; box-shadow: 0 6px 15px var(--card-shadow);
            border: 1px solid var(--border-color); display: flex;
            flex-direction: row; align-items: center; justify-content: space-between;
        }
        .market-item-modern::before {
            content: '';
            position: absolute; top: 0; left: 0; width: 4px; height: 100%;
        }
        .market-item-modern.blue::before { background: var(--accent-blue); }
        .market-item-modern.green::before { background: var(--accent-green); }
        .market-item-modern.orange::before { background: #f39c12; }
        
        .mk-left { display: flex; flex-direction: column; gap: 4px; }
        .mk-label {
            font-size: 14px; font-weight: 700; color: var(--text-main); letter-spacing: 0px;
            text-transform: none; margin-bottom: 0;
        }
        .mk-val {
            font-size: 16px; font-weight: 800; color: var(--text-main); letter-spacing: -0.5px;
        }
        .mk-dynamics {
            font-size: 12px; font-weight: 700; padding: 4px 8px; border-radius: 8px;
        }
        .mk-dynamics.positive { background: var(--badge-green-bg); color: var(--accent-green); }
        .mk-dynamics.negative { background: rgba(231, 76, 60, 0.1); color: var(--accent-red); }
        .mk-dynamics.neutral { background: rgba(0,0,0,0.05); color: var(--text-secondary); }
        .dark-mode .mk-dynamics.neutral { background: rgba(255,255,255,0.1); }
        
        .rates-vertical-block {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 15px;
            margin-bottom: 25px;
            box-shadow: 0 6px 15px var(--card-shadow);
            border: 1px solid var(--border-color);
        }
        .rv-title {
            font-size: 11px; color: #8e8e93; font-weight: 700; text-transform: uppercase;
            margin-bottom: 12px; letter-spacing: 0.5px;
        }
        .rv-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
        }
        .rv-item {
            display: flex; flex-direction: column; gap: 4px;
            background: rgba(0,0,0,0.02); padding: 10px; border-radius: 12px;
        }
        .dark-mode .rv-item { background: rgba(255,255,255,0.03); }
        .rv-item span { font-size: 10px; color: #8e8e93; font-weight: 600; }
        .rv-item b { font-size: 15px; color: var(--text-main); font-weight: 800; }

        .info-card {
            background: var(--card-bg);
            padding: 20px; border-radius: 20px; margin-bottom: 15px;
            border: 1px solid var(--border-color); box-shadow: 0 5px 15px var(--card-shadow); 
            position: relative; overflow: hidden; transition: transform 0.2s;
        }
        .info-card:active { transform: scale(0.99); }
        .info-card.bonds { border-left: 4px solid var(--accent-blue); background: linear-gradient(to right, rgba(52, 152, 219, 0.03), var(--card-bg)); }
        .info-card.stocks { border-left: 4px solid var(--accent-green); background: linear-gradient(to right, rgba(46, 204, 113, 0.03), var(--card-bg)); }

        .info-card-header { font-size: 18px; font-weight: 800; margin-bottom: 4px; display: flex; align-items: center; gap: 8px; }
        .bonds .info-card-header { color: var(--accent-blue); }
        .stocks .info-card-header { color: var(--accent-green); }

        .info-card-sub-clean { font-size: 10px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; margin: 0 0 10px 0; opacity: 0.7; }
        .bonds .info-card-sub-clean { color: var(--accent-blue); }
        .stocks .info-card-sub-clean { color: var(--accent-green); }
        
        .info-card-text { font-size: 13px; line-height: 1.6; color: var(--text-main); margin-bottom: 15px; opacity: 0.8; }
        
        .info-card-badge {
            display: inline-flex; align-items: center; justify-content: center;
            padding: 6px 12px; border-radius: 8px; font-size: 10px; font-weight: 900; letter-spacing: 0.5px;
        }
        .badge-blue { background: var(--badge-blue-bg); color: var(--accent-blue); }
        .badge-green { background: var(--badge-green-bg); color: var(--accent-green); }

        .btn-action {
            display: flex; align-items: center; justify-content: center; width: 100%; padding: 16px; margin-top: 12px;
            background: var(--coupon-blue-bg); color: var(--accent-blue);
            border: 1px solid var(--accent-blue); border-radius: 16px;
            font-size: 14px; font-weight: bold; cursor: pointer; transition: all 0.2s; gap: 8px;
        }
        .btn-action:active { opacity: 0.7; transform: scale(0.98); }

        @keyframes shimmerBtn {
            0% { box-shadow: 0 12px 25px rgba(48, 61, 79, 0.3); transform: scale(1); }
            50% { box-shadow: 0 12px 30px rgba(48, 61, 79, 0.5); transform: scale(1.01); }
            100% { box-shadow: 0 12px 25px rgba(48, 61, 79, 0.3); transform: scale(1); }
        }

        .btn-graphite {
            position: relative;
            background: var(--graphite-color); color: white; border: none; overflow: hidden;
            box-shadow: 0 12px 25px rgba(48, 61, 79, 0.3); margin-top: 15px;
            padding: 20px; font-size: 16px; border-radius: 20px;
            display: flex; align-items: center; justify-content: center; gap: 12px;
            width: 100%; box-sizing: border-box; font-weight: 900;
            animation: shimmerBtn 3s infinite ease-in-out;
            cursor: pointer;
        }
        .btn-graphite svg { width: 32px; height: 32px; fill: none; stroke: white; stroke-width: 2; }
        .btn-graphite:active { transform: scale(0.98); animation: none; }

        .start-expl { font-size: 11px; color: #8e8e93; text-align: center; margin-top: 8px; padding: 0 10px; line-height: 1.5; }

        .header { text-align: center; margin-bottom: 20px; }
        h1 { font-size: 20px; margin-bottom: 4px; }

/* =========================== */
/* НОВЫЕ СТИЛИ ДЛЯ 2-Й ВКЛАДКИ */
/* =========================== */

.terminal-brand {
    font-size: 28px;
    font-weight: 800;
    letter-spacing: -0.03em;
    color: var(--brand-color);
}

.terminal-subtitle {
    font-size: 13px;
    color: #8e8e93;
    margin-top: 4px;
}

/* Amount Input Styling */
.premium-input-container {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
}

.amount-wrapper {
    display: flex;
    align-items: baseline;
    justify-content: center;
    width: 100%;
}

.premium-input {
    background: transparent;
    border: none;
    text-align: center;
    font-family: 'JetBrains Mono', monospace;
    font-size: 48px;
    font-weight: 300;
    letter-spacing: -0.02em;
    width: auto;
    min-width: 40px;
    outline: none;
    color: var(--brand-color);
    font-variant-numeric: tabular-nums;
    font-feature-settings: "liga" 0;
    z-index: 2;
}

.amount-underline {
    width: 40px;
    height: 2.5px;
    background: var(--brand-color);
    border-radius: 10px;
    opacity: 0.25;
    margin-top: -4px;
}

/* Custom Premium Select */
.custom-select-container {
    position: relative;
    user-select: none;
}
.select-trigger {
    background: rgba(255, 255, 255, 0.6);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(0,0,0,0.05);
    border-radius: 20px;
    padding: 16px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    transition: all 0.2s ease;
}
.select-options {
    position: absolute;
    top: calc(100% + 8px);
    left: 0;
    right: 0;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 20px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    border: 1px solid rgba(0,0,0,0.05);
    z-index: 100;
    opacity: 0;
    transform: translateY(-10px);
    pointer-events: none;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    max-height: 250px;
    overflow-y: auto;
}
.select-options.open {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
}
.option-item {
    padding: 14px 20px;
    font-size: 14px;
    font-weight: 500;
    border-bottom: 1px solid rgba(0,0,0,0.03);
    transition: background 0.2s;
}
.option-item:last-child { border-bottom: none; }
.option-item:active { background: rgba(0,0,0,0.03); }

/* Strategy Cards */
.strategy-card {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border: 1px solid rgba(0, 0, 0, 0.03);
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(10px);
    border-radius: 28px;
    margin-bottom: 12px;
}
.strategy-card.active {
    border-color: var(--brand-color);
    background: #FFFFFF;
    box-shadow: 0 15px 30px rgba(51, 61, 77, 0.08);
    transform: scale(1.01);
}

/* Gear Icon Premium Styling */
.gear-container {
    width: 56px;
    height: 56px;
    background: linear-gradient(135deg, #ffffff 0%, #f4f6f9 100%);
    border: 1px solid rgba(51, 61, 77, 0.12);
    box-shadow: inset 0 2px 4px rgba(255,255,255,1), 0 4px 12px rgba(0,0,0,0.04);
    border-radius: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    position: relative;
}
.gear-container::after {
    content: '';
    position: absolute;
    top: -2px; left: -2px; right: -2px; bottom: -2px;
    border-radius: 100%;
    border: 0.5px solid rgba(51, 61, 77, 0.05);
    pointer-events: none;
}
.strategy-card.active .gear-container {
    border-color: rgba(51, 61, 77, 0.3);
    box-shadow: 0 10px 25px rgba(51, 61, 77, 0.15);
    transform: rotate(60deg);
}
.gear-icon {
    color: var(--brand-color);
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.15));
    opacity: 0.9;
}

/* Premium Slider Block */
.premium-slider-block {
    background: linear-gradient(165deg, rgba(255,255,255,0.9) 0%, rgba(248,250,252,0.8) 100%);
    backdrop-filter: blur(25px);
    border: 1px solid rgba(255,255,255,0.6);
    box-shadow: 0 25px 50px -12px rgba(51, 61, 77, 0.12);
    border-radius: 36px;
    padding: 30px;
    position: relative;
    overflow: hidden;
}
.premium-slider-block::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; height: 1px;
    background: linear-gradient(90deg, transparent, rgba(51, 61, 77, 0.1), transparent);
}

/* Range Slider Styling */
input[type=range] {
    -webkit-appearance: none;
    width: 100%;
    background: transparent;
}
input[type=range]:focus { outline: none; }
input[type=range]::-webkit-slider-runnable-track {
    width: 100%;
    height: 8px;
    cursor: pointer;
    background: linear-gradient(90deg, rgba(51, 61, 77, 0.05) 0%, rgba(51, 61, 77, 0.15) 100%);
    border-radius: 10px;
}
input[type=range]::-webkit-slider-thumb {
    height: 28px;
    width: 28px;
    border-radius: 50%;
    background: #FFFFFF;
    border: 6px solid var(--brand-color);
    cursor: pointer;
    -webkit-appearance: none;
    margin-top: -10px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.12);
    transition: transform 0.2s ease;
}
input[type=range]:active::-webkit-slider-thumb {
    transform: scale(1.15);
}

.divider-line {
    width: 1px;
    height: 32px;
    background: rgba(0, 0, 0, 0.08);
    margin: 0 16px;
}

.bottom-sticky-panel {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(20px);
    padding: 20px 24px 44px 24px;
    z-index: 50;
}

.chart-ring {
    transition: stroke-dashoffset 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    stroke: var(--brand-color);
}

.fade-in-up {
    animation: fadeInUp 0.5s cubic-bezier(0.23, 1, 0.32, 1) forwards;
}
@keyframes fadeInUp {
    from { opacity: 0; transform: translateY(15px); }
    to { opacity: 1; transform: translateY(0); }
}

/* ========================= */
/* КОНЕЦ НОВЫХ СТИЛЕЙ       */
/* ========================= */
        
        .calc-box {
            background: var(--card-bg); padding: 24px; border-radius: 24px;
            box-shadow: 0 15px 35px var(--card-shadow); margin-bottom: 25px; border: 1px solid var(--border-color);
        }
        .calc-top { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
        .input-container { flex: 1; }
        .input-label { font-size: 13px; color: #8e8e93; font-weight: 600; margin-bottom: 8px; display: block; text-transform: uppercase; letter-spacing: 0.5px; }
        .input-wrapper { display: flex; align-items: baseline; gap: 8px; }
        input#sumInput { 
            border: none; font-size: 34px; font-weight: 700; width: 100%; outline: none; 
            color: var(--input-color); background: transparent; margin: 0; padding: 0; line-height: 1;
        }
        .currency { font-size: 28px; color: #d1d1d6; font-weight: 500; }

        .usage-bar-container { margin-bottom: 20px; }
        .usage-label { font-size: 10px; color: #8e8e93; display: flex; justify-content: space-between; margin-bottom: 4px; font-weight: bold; }
        .usage-track { height: 4px; background: #eee; border-radius: 2px; overflow: hidden; }
        #usageFill { height: 100%; width: 0%; background: var(--accent-green); transition: width 0.3s; }

        .fee-selector { margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--item-border); }
        .fee-label { font-size: 11px; color: #8e8e93; font-weight: bold; margin-bottom: 8px; display: block; text-transform: uppercase; }
        .fee-buttons { display: flex; flex-wrap: wrap; gap: 6px; }
        .fee-btn {
            padding: 6px 10px; border-radius: 8px; border: 1px solid #e1e8ed; background: var(--card-bg);
            font-size: 11px; font-weight: 600; color: #5d7185; cursor: pointer; transition: all 0.2s;
        }
        .fee-btn.active { background: var(--accent-blue); color: white; border-color: var(--accent-blue); }

        .chart-mini {
            width: 60px; height: 60px; border-radius: 18px; 
            background: conic-gradient(var(--accent-blue) 0% 50%, var(--accent-green) 50% 100%);
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 8px 15px rgba(52, 152, 219, 0.2); flex-shrink: 0; margin-left: 15px;
            transition: background 0.3s; cursor: pointer;
        }
        .chart-mini::after { content: attr(data-pct); font-size: 10px; font-weight: 900; color: white; }

        .ratio-control { padding-top: 5px; }
        .ratio-slider {
            -webkit-appearance: none; width: 100%; height: 6px; border-radius: 5px;
            background: #e0e0e0; outline: none; margin: 15px 0;
        }
        .ratio-slider::-webkit-slider-thumb {
            -webkit-appearance: none; width: 20px; height: 20px; border-radius: 50%;
            background: var(--accent-blue); cursor: pointer; border: 3px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .slider-hint-wrapper { 
            display: flex; align-items: center; justify-content: center; gap: 8px;
            margin-top: 8px; 
        }
        .slider-hint { font-size: 10px; color: #8e8e93; text-align: center; }
        .preset-dropdown-btn {
            width: 24px; height: 24px; border-radius: 50%; background: var(--accent-blue);
            color: white; display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: transform 0.3s;
        }
        .preset-dropdown-btn.open { transform: rotate(180deg); }
        .preset-dropdown-btn svg { width: 14px; height: 14px; stroke: currentColor; fill: none; stroke-width: 2.5; }
        
        .preset-options {
            display: none; margin-top: 15px; background: var(--card-bg);
            border-radius: 16px; padding: 12px; gap: 10px;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 20px var(--card-shadow);
        }
        .preset-options.show { display: flex; flex-direction: column; }
        
        .preset-btn-modern {
            display: flex; align-items: center; justify-content: space-between;
            padding: 14px 16px; border-radius: 12px; border: 1px solid var(--item-border);
            background: var(--bg-color); cursor: pointer; 
            transition: transform 0.1s, border-color 0.2s;
        }
        
        .preset-btn-modern.selected-preset {
            border: 2px solid var(--accent-blue);
            background: transparent !important;
            box-shadow: none;
        }
        .preset-btn-modern.selected-preset .preset-right {
            color: var(--accent-blue);
        }
        
        .preset-btn-modern:hover:not(.selected-preset) {
            background: var(--accent-blue); border-color: var(--accent-blue);
        }
        .preset-btn-modern:hover:not(.selected-preset) .preset-left { color: white; }
        .preset-btn-modern:hover:not(.selected-preset) .preset-right { color: rgba(255,255,255,0.8); }
        .preset-btn-modern:hover:not(.selected-preset) .preset-icon { background: rgba(255,255,255,0.2); }
        
        .preset-btn-modern:active:not(.selected-preset) {
            transform: scale(0.98);
        }

        .preset-left { display: flex; align-items: center; gap: 12px; color: var(--text-main); }
        .preset-icon {
            width: 36px; height: 36px; border-radius: 10px;
            background: var(--coupon-blue-bg); display: flex; align-items: center; justify-content: center;
            font-size: 16px;
        }
        .preset-title { font-weight: 700; font-size: 14px; }
        .preset-subtitle { font-size: 11px; color: var(--text-secondary); margin-top: 2px; }
        .preset-right { font-size: 18px; font-weight: 800; color: var(--accent-blue); }
        .preset-footer-hint { font-size: 10px; color: #8e8e93; text-align: center; margin-top: 8px; font-style: italic; }

        #shareContainer { background: var(--bg-color); padding: 5px 10px 20px; border-radius: 10px; }
        .asset-list { background: var(--card-bg); border-radius: 12px; margin-bottom: 15px; overflow: hidden; }
        .asset-item {
            display: grid; grid-template-columns: 85px 1fr 75px 80px; padding: 12px; 
            border-bottom: 1px solid var(--item-border); font-size: 12px; align-items: center;
        }
        .asset-item:last-child { border-bottom: none; }
        .ticker { font-weight: bold; color: var(--text-main); }
        .asset-name { color: #8e8e93; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-right: 5px; }
        .qty { text-align: right; padding-right: 8px; font-weight: bold; color: var(--accent-blue); }
        .price-total { text-align: right; color: var(--text-main); font-weight: 500; }
        
        .asset-yield-badge {
            background: rgba(46, 204, 113, 0.15); color: var(--accent-green);
            font-weight: 800; font-size: 11px; padding: 4px 8px; border-radius: 8px;
            display: flex; align-items: center; justify-content: center; width: 100%;
            box-sizing: border-box;
        }
        .asset-yield-badge.blue { background: rgba(52, 152, 219, 0.15); color: var(--accent-blue); }

        .details {
            grid-column: 1 / -1; display: none; background: rgba(0,0,0,0.02);
            padding: 12px; border-top: 1px solid var(--item-border); font-size: 11px;
            color: #8e8e93; line-height: 1.8;
        }
        .asset-item.active .details { display: block; }
        .detail-row { display: flex; justify-content: space-between; border-bottom: 1px dashed rgba(0,0,0,0.05); padding: 2px 0; }
        .detail-row span:last-child { color: var(--text-main); font-weight: 600; }
        
        .btn-tiny-graph {
             background: var(--accent-blue); color: white; border: none;
             padding: 6px 12px; border-radius: 6px; font-size: 10px; font-weight: bold;
             margin-top: 8px; cursor: pointer; width: 100%; display: flex; align-items: center; justify-content: center;
             gap: 4px; box-shadow: 0 2px 5px rgba(52, 152, 219, 0.2);
        }

        .section-header-highlight {
            margin: 25px 0 8px; padding: 12px 16px; border-radius: 16px;
            font-weight: 800; font-size: 16px; 
            background: var(--header-light-gradient); color: var(--text-main);
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); border: 1px solid rgba(52, 152, 219, 0.2);
            display: flex; align-items: center; justify-content: space-between;
        }
        .section-desc-small { font-size: 11px; color: #8e8e93; margin-bottom: 12px; padding: 0 5px; line-height: 1.4; }

        .section-header-styled {
            margin: 25px 0 12px; background: linear-gradient(135deg, #ffffff, #f0f2f5);
            padding: 14px 16px; border-radius: 16px;
            font-weight: 900; font-size: 16px; display: flex; align-items: center; justify-content: space-between;
            color: var(--graphite-color); box-shadow: 0 4px 12px rgba(0,0,0,0.08); border: 1px solid rgba(255,255,255,0.5);
            cursor: pointer;
        }
        .dark-mode .section-header-styled {
            background: linear-gradient(135deg, #1e293b, #0f172a);
            color: #f1f5f9; border-color: rgba(255,255,255,0.1);
        }
        
        .info-expanded-block {
            display: none;
            background: var(--card-bg); border-radius: 16px; padding: 15px; margin-bottom: 15px;
            border: 1px solid var(--accent-blue); font-size: 12px; line-height: 1.5; color: var(--text-secondary);
            animation: fadeIn 0.3s ease;
        }
        .info-expanded-block.show { display: block; }
        
        .echelon-info-graphic {
            display: flex; flex-direction: column; gap: 10px; margin-top: 10px;
        }
        .eig-item {
            display: flex; align-items: center; gap: 14px;
            padding: 14px 16px; border-radius: 16px;
            background: linear-gradient(135deg, var(--bg-color), rgba(255,255,255,0.5));
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 12px var(--card-shadow);
            position: relative;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .eig-item:active { transform: scale(0.98); }
        .eig-item::before {
            content: '';
            position: absolute;
            left: 0; top: 0; bottom: 0; width: 4px;
        }
        .eig-item.e1::before { background: linear-gradient(180deg, #2ecc71, #27ae60); }
        .eig-item.e2::before { background: linear-gradient(180deg, #3498db, #2980b9); }
        .eig-item.e3::before { background: linear-gradient(180deg, #f1c40f, #f39c12); }
        .eig-item.e4::before { background: linear-gradient(180deg, #e67e22, #d35400); }
        
        .eig-icon {
            width: 44px; height: 44px; border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-size: 22px; flex-shrink: 0;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .eig-item.e1 .eig-icon { background: linear-gradient(135deg, rgba(46,204,113,0.2), rgba(46,204,113,0.05)); }
        .eig-item.e2 .eig-icon { background: linear-gradient(135deg, rgba(52,152,219,0.2), rgba(52,152,219,0.05)); }
        .eig-item.e3 .eig-icon { background: linear-gradient(135deg, rgba(241,196,15,0.2), rgba(241,196,15,0.05)); }
        .eig-item.e4 .eig-icon { background: linear-gradient(135deg, rgba(230,126,34,0.2), rgba(230,126,34,0.05)); }
        
        .eig-text { flex: 1; }
        .eig-title { 
            font-weight: 800; font-size: 13px; color: var(--text-main); margin-bottom: 4px;
            display: flex; align-items: center; gap: 8px;
        }
        .eig-badge {
            font-size: 9px; font-weight: 700; padding: 2px 6px; border-radius: 4px;
            text-transform: uppercase; letter-spacing: 0.5px;
        }
        .eig-item.e1 .eig-badge { background: rgba(46,204,113,0.15); color: #27ae60; }
        .eig-item.e2 .eig-badge { background: rgba(52,152,219,0.15); color: #2980b9; }
        .eig-item.e3 .eig-badge { background: rgba(241,196,15,0.15); color: #f39c12; }
        .eig-item.e4 .eig-badge { background: rgba(230,126,34,0.15); color: #d35400; }
        
        .eig-desc { font-size: 11px; color: var(--text-secondary); line-height: 1.5; }
        
        .eig-arrow {
            width: 24px; height: 24px; border-radius: 50%;
            background: var(--card-bg); display: flex; align-items: center; justify-content: center;
            color: var(--text-secondary); flex-shrink: 0;
        }

        .allocation-info-connected {
            display: flex; align-items: stretch; justify-content: space-between;
            margin-bottom: 12px; width: 100%;
            background: var(--card-bg); border: 1px solid var(--accent-blue);
            border-radius: 20px; padding: 0; position: relative; overflow: hidden;
        }
        .alloc-left {
            padding: 8px 16px; font-size: 13px; color: var(--text-main);
            display: flex; align-items: center; flex: 1; border: none; background: transparent;
        }
        .alloc-right {
            background: var(--accent-blue); color: white; padding: 8px 16px;
            font-weight: 800; font-size: 11px; display: flex; align-items: center;
            white-space: nowrap; border-radius: 20px; margin: 2px;
        }
        
        .section-transition {
            display: flex; align-items: center; justify-content: center; gap: 10px;
            margin: 15px 0 25px; opacity: 1; position: relative;
        }
        .st-line { height: 1px; flex: 1; background: linear-gradient(90deg, transparent, var(--accent-blue)); }
        .st-line.rev { background: linear-gradient(90deg, var(--accent-blue), transparent); }
        .st-icon {
            width: 32px; height: 32px; border-radius: 50%;
            background: var(--card-bg); color: var(--accent-blue);
            border: 1px solid var(--accent-blue); display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.2); z-index: 5; font-size: 20px; line-height: 1;
        }
        
        .echelon-separator-modern {
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px 0; margin-top: 15px; margin-bottom: 5px;
            border-bottom: 2px solid var(--item-border);
        }
        .esm-left { display: flex; align-items: center; gap: 8px; }
        .esm-dot { width: 8px; height: 8px; border-radius: 50%; }
        .esm-title { font-weight: 800; font-size: 12px; color: var(--text-main); text-transform: uppercase; letter-spacing: 0.5px; }

        .echelon-separator-modern.echelon-1 .esm-dot { background-color: var(--accent-green); }
        .echelon-separator-modern.echelon-2 .esm-dot { background-color: var(--accent-blue); }
        .echelon-separator-modern.echelon-3 .esm-dot { background-color: var(--accent-yellow); }
        .echelon-separator-modern.echelon-4 .esm-dot { background-color: var(--accent-orange); }

        .esm-info-btn-light {
            width: 18px; height: 18px; border-radius: 50%; 
            background: rgba(255,255,255,0.8); color: var(--accent-blue);
            font-size: 11px; font-weight: bold; display: flex; align-items: center; justify-content: center;
            cursor: pointer; border: 1px solid rgba(0,0,0,0.1);
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .esm-info-btn-light:hover { background: var(--accent-blue); color: white; border-color: var(--accent-blue); }
        
        .esm-pct { 
            font-size: 12px; font-weight: normal; color: var(--text-secondary); 
            display: flex; align-items: center; gap: 8px;
        }
        .esm-sum { color: var(--accent-blue); font-weight: 300; font-size: 13px; }
        .esm-divider { color: var(--item-border); font-weight: 300; }
        .esm-percent {
            background: rgba(52,152,219,0.1); padding: 4px 10px; border-radius: 8px; 
            color: var(--accent-blue); font-weight: 800; display: flex; align-items: center;
        }
        
        .echelon-tip {
            display: none; 
            background: #3a506b; color: white; padding: 10px; border-radius: 8px;
            font-size: 11px; font-weight: normal; line-height: 1.3;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); margin-bottom: 10px;
        }
        .echelon-tip.show { display: block; animation: fadeIn 0.2s ease; }

        .coupon-box {
            background: var(--card-bg); border-radius: 16px; margin-top: 10px;
            border: 1px solid var(--accent-blue); overflow: hidden; margin-bottom: 10px;
            position: relative; z-index: 2;
        }
        .coupon-header {
            padding: 12px 14px; background: var(--coupon-blue-bg); color: var(--accent-blue);
            font-weight: bold; font-size: 14px; display: flex; justify-content: space-between; cursor: pointer; align-items: center;
            position: relative;
        }
        .coupon-title-wrapper { display: flex; align-items: flex-start; gap: 10px; }
        .coupon-icon-lg { font-size: 20px; line-height: 1.2; }
        .coupon-text-col { display: flex; flex-direction: column; line-height: 1.1; }
        .coupon-main-text { font-size: 14px; font-weight: 800; }
        .coupon-preview-mini { font-size: 9px; opacity: 0.7; font-weight: normal; margin-top: 2px; }
        .coupon-content { display: none; padding: 0 12px 12px; }
        .coupon-content.active { display: block; }
        
        .coupon-table-head {
            display: grid; grid-template-columns: 85px 1fr 50px 70px; gap: 5px;
            padding: 8px 0; font-size: 9px; font-weight: 800; color: #95a5a6;
            border-bottom: 2px solid var(--item-border); margin-top: 10px; margin-bottom: 5px;
        }
        .coupon-row {
            display: grid; grid-template-columns: 85px 1fr 50px 70px; gap: 5px;
            padding: 10px 0; border-bottom: 1px solid var(--item-border); font-size: 11px; align-items: center;
        }
        .coupon-row:last-child { border-bottom: none; }
        .coupon-row b { color: var(--text-main); }
        .arrow-icon { width: 14px; height: 14px; fill: currentColor; transition: transform 0.3s; }
        .coupon-content.active + .coupon-header .arrow-icon, 
        .coupon-header[onclick*="toggle"] .arrow-icon.rotated { transform: rotate(180deg); }

        .tax-selector-ui { display: flex; background: var(--bg-color); border-radius: 10px; padding: 3px; margin: 12px 0; gap: 2px; }
        .tax-ui-btn {
            flex: 1; border: none; background: transparent; padding: 6px;
            font-size: 11px; font-weight: bold; color: #8e8e93; border-radius: 8px;
            cursor: pointer; transition: all 0.2s;
        }
        .tax-ui-btn.active { background: var(--card-bg); color: var(--accent-blue); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        .footer-disclaimer-important {
            margin-top: 15px; margin-bottom: 25px; text-align: left; 
            color: var(--text-main); 
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.05), rgba(46, 204, 113, 0.15));
            padding: 20px; border-radius: 20px; 
            border: 1px solid rgba(46, 204, 113, 0.2);
            font-size: 13px; line-height: 1.6;
            position: relative; overflow: hidden;
            box-shadow: 0 10px 30px rgba(46, 204, 113, 0.1);
        }
        .footer-disclaimer-important::before {
            content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 6px;
            background: var(--accent-green);
        }
        .footer-disclaimer { text-align: center; font-size: 11px; color: #99aab5; margin-top: 30px; padding: 0 20px; }

        .nav-wrapper {
            position: fixed; bottom: 25px; left: 0; width: 100%; 
            display: flex; justify-content: center; gap: 10px;
            padding: 0 15px; box-sizing: border-box; z-index: 900;
        }
        .nav-dock {
            background: var(--nav-bg); backdrop-filter: blur(25px) saturate(180%);
            -webkit-backdrop-filter: blur(25px) saturate(180%);
            border-radius: 25px; display: flex; align-items: center; padding: 8px 15px; gap: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15); border: 1px solid var(--nav-border);
            transition: opacity 0.3s;
        }
        .nav-dock.hidden { opacity: 0; pointer-events: none; position: absolute; }
        
        .nav-search-btn {
            width: 50px; height: 50px; border-radius: 50%;
            background: var(--nav-bg); backdrop-filter: blur(25px) saturate(180%);
            -webkit-backdrop-filter: blur(25px) saturate(180%);
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15); border: 1px solid var(--nav-border);
            cursor: pointer; color: var(--nav-icon-inactive); transition: all 0.2s; position: relative;
        }
        .nav-search-btn.active { background: var(--accent-blue); color: white; border-color: var(--accent-blue); }
        .nav-search-btn:active { transform: scale(0.9); }
        
        .nav-search-expanded {
            position: absolute; bottom: 0; left: 15px; right: 15px;
            height: 66px;
            background: var(--nav-bg);
            backdrop-filter: blur(25px) saturate(180%);
            -webkit-backdrop-filter: blur(25px) saturate(180%);
            border-radius: 25px;
            display: flex; align-items: center; padding: 0 5px; gap: 5px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15); 
            border: none;
            transform: translateY(150%); transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 910;
        }
        .nav-search-expanded.active { transform: translateY(0); }
        
        .nav-search-input-bar {
            flex: 1; border: none; background: rgba(0,0,0,0.05);
            height: 44px; border-radius: 22px; padding: 0 15px;
            font-size: 14px; outline: none; color: var(--text-main);
            box-shadow: none; -webkit-appearance: none;
        }
        .dark-mode .nav-search-input-bar { background: rgba(255,255,255,0.1); }
        .nav-search-input-bar:focus { outline: none; }

        .nav-item {
            display: flex; align-items: center; justify-content: center; width: 44px; height: 44px;
            border-radius: 15px; cursor: pointer; transition: all 0.2s; color: var(--nav-icon-inactive);
        }
        .nav-item.active { color: var(--accent-blue); background: rgba(52, 152, 219, 0.1); }
        .nav-item svg { width: 22px; height: 22px; stroke: currentColor; fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
        .nav-item:active { transform: scale(0.9); }
        
        .nav-back-island {
            width: 44px; height: 44px; border-radius: 15px;
            background: var(--card-bg); border: 1px solid var(--border-color);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; color: var(--accent-blue);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .nav-back-island svg { width: 22px; height: 22px; stroke: currentColor; fill: none; stroke-width: 2; }

        .theme-toggle-mini {
            width: 24px; height: 24px; border-radius: 50%;
            background: var(--card-bg); color: var(--text-main); 
            border: 1px solid var(--border-color);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; position: absolute; top: -10px; right: -12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); z-index: 910;
        }
        .theme-toggle-mini svg { width: 14px; height: 14px; stroke: currentColor; fill: none; }

        .list-header-row {
            display: grid; padding: 0 16px; margin-bottom: 5px;
            font-size: 9px; font-weight: 700; color: #95a5a6; text-transform: uppercase; letter-spacing: 0.5px;
        }
        .list-header-row.ofz-cols {
            grid-template-columns: 1fr 60px 60px 70px; gap: 8px; text-align: right;
        }
        .list-header-row.ofz-cols span:first-child { text-align: left; }
        .list-header-row.ofz-cols span:nth-child(2), .list-header-row.ofz-cols span:nth-child(3) { text-align: center; }
        
        .list-header-row.calc-cols {
            display: grid; grid-template-columns: 1fr 70px 100px; gap: 8px;
            text-align: right; margin-bottom: 8px;
        }
        .list-header-row.calc-cols span:first-child { text-align: left; }
        
        .ofz-card-modern {
            background: var(--card-bg); border-radius: 16px;
            padding: 14px 16px; margin-bottom: 10px;
            border: 1px solid var(--border-color);
            display: grid; grid-template-columns: 1fr 60px 60px 70px; 
            align-items: center; gap: 8px;
            box-shadow: 0 4px 10px var(--card-shadow);
            cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;
            position: relative; overflow: hidden;
        }
        .ofz-card-modern::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 4px; background: var(--accent-blue); }
        .ofz-card-modern:active { transform: scale(0.98); }
        .ofz-main-info { display: flex; flex-direction: column; gap: 4px; overflow: hidden; }
        .ofz-name-lg { font-weight: 700; font-size: 13px; color: var(--text-main); line-height: 1.2; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .ofz-ticker-sm { font-size: 10px; color: #8e8e93; font-weight: 600; text-transform: uppercase; }
        
        .ofz-nkd-badge {
            font-size: 12px; font-weight: 700; color: #7f8c8d; text-align: center;
            background: rgba(0,0,0,0.04); padding: 4px 8px; border-radius: 8px;
        }
        .ofz-price { 
            font-size: 12px; font-weight: 700; color: #7f8c8d; text-align: center; 
            background: rgba(0,0,0,0.04); padding: 4px 8px; border-radius: 8px;
        }
        
        .ofz-yield-badge { 
            font-weight: 800; font-size: 13px; color: var(--accent-green); 
            background: rgba(46, 204, 113, 0.1); padding: 6px 8px; border-radius: 10px; 
            display: flex; align-items: center; justify-content: center; gap: 2px;
        }
        .ofz-arrow { width: 10px; height: 10px; fill: currentColor; }
        
        .ofz-details-panel {
            display: none; background: rgba(0,0,0,0.02);
            padding: 12px; border-radius: 0 0 16px 16px; margin-top: -10px; margin-bottom: 10px;
            border: 1px solid var(--border-color); border-top: none; font-size: 11px; color: var(--text-secondary);
        }
        .ofz-details-panel.active { display: block; animation: fadeIn 0.3s; }
        .ofz-detail-row { display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px dashed rgba(0,0,0,0.05); padding: 2px 0; }
        .ofz-detail-val { font-weight: bold; color: var(--text-main); }

        .calc-badge-modern {
            font-size: 10px; background: linear-gradient(135deg, #34495e, #2c3e50); color: white; 
            padding: 4px 10px; border-radius: 20px; font-weight: 700;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); letter-spacing: 0.5px;
        }

        .monthly-calc-box {
            background: var(--bg-color);
            padding: 12px;
            border-radius: 12px;
            margin-bottom: 10px;
        }

        .monthly-calc-box .input-wrapper input {
            font-size: 28px;
        }

        .calc-expl-text {
            font-size: 11px;
            color: var(--text-secondary);
            text-align: center;
            line-height: 1.5;
            padding: 0 10px;
            margin: 15px 0;
        }

        .calc-bond-row {
            display: grid; grid-template-columns: 1fr 70px 100px; align-items: center;
            padding: 10px 0; border-bottom: 1px dashed var(--item-border); gap: 8px;
        }
        .calc-bond-row:last-child { border-bottom: none; }
        .unified-badge-container { display: flex; align-items: center; width: 100%; overflow: hidden; border-radius: 8px; font-size: 10px; font-weight: bold; }
        .ub-name {
            background: #ffffff; color: var(--text-main); padding: 4px 8px; border: 1px solid #dfe6e9;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis; border-radius: 6px; width: 100%;
        }
        .ub-price {
            background: #dfe6e9; color: #636e72; padding: 4px 8px; border-radius: 6px;
            white-space: nowrap; font-size: 11px; text-align: center;
        }
        .ub-yield {
            background: rgba(46, 204, 113, 0.2); color: #27ae60; padding: 4px 8px; white-space: nowrap;
            border-radius: 6px; font-size: 11px; text-align: center; width: 100%;
        }
        .dark-mode .ub-name { background: #1e293b; color: #f1f5f9; border-color: #334155; }
        .dark-mode .ub-price { background: #475569; color: #94a3b8; }

        .qty-controls { display: flex; align-items: center; gap: 4px; justify-content: flex-end; }
        .qty-btn { 
            width: 28px; height: 28px; border-radius: 6px; background: var(--card-bg); 
            display: flex; align-items: center; justify-content: center; font-weight: 900; color: var(--accent-blue);
            cursor: pointer; box-shadow: 0 1px 3px rgba(0,0,0,0.1); font-size: 16px;
            border: 1px solid var(--border-color);
        }
        .qty-btn:active { transform: scale(0.9); background: #eee; }
        .calc-input {
            width: 44px;
            border: none;
            font-size: 12px;
            font-weight: bold; text-align: center;
            background: transparent; color: var(--text-main); outline: none; padding: 0;
            -moz-appearance: textfield;
        }
        .calc-input::-webkit-outer-spin-button,
        .calc-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .btn-row-reset {
            width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;
            color: #e74c3c; cursor: pointer; opacity: 0.7;
        }
        
        .result-list-container { margin-top: 15px; background: rgba(0,0,0,0.02); border-radius: 8px; padding: 10px; }
        .dark-mode .result-list-container { background: rgba(255,255,255,0.03); }

        .info-i-blue {
            display: inline-flex; width: 24px; height: 24px; border-radius: 50%; color: var(--accent-blue);
            font-size: 14px; font-weight: bold; align-items: center; justify-content: center; margin-left: 6px; cursor: pointer;
        }
        
        .info-preview-box {
            display: none;
            background: var(--coupon-blue-bg);
            color: var(--accent-blue);
            padding: 12px 16px;
            border-radius: 12px;
            margin: -5px 0 15px 0;
            font-size: 11px;
            font-weight: 500;
            line-height: 1.5;
            border: 1px solid rgba(52, 152, 219, 0.2);
            animation: fadeIn 0.3s;
        }
        .info-preview-box.show { display: block; }
        
        .search-container { padding: 10px 0; }
        .search-result-item { background: var(--card-bg); padding: 15px; border-radius: 12px; margin-bottom: 10px; border: 1px solid var(--item-border); cursor: pointer; }
        .search-result-item:active { background: rgba(0,0,0,0.02); }
        
        .btn-reset-wide {
            width: 100%; box-sizing: border-box;
            padding: 12px; border: none; background: #f1f2f6; color: #7f8c8d;
            border-radius: 12px; font-size: 12px; font-weight: bold; cursor: pointer; margin-top: 15px;
            display: flex; align-items: center; justify-content: center; gap: 8px; transition: background 0.2s;
        }
        .btn-reset-wide:active { background: #e0e0e0; }
        .dark-mode .btn-reset-wide { background: #2d3748; color: #cbd5e0; }
        
        .rebalance-intro-modern {
            background: linear-gradient(135deg, var(--card-bg), var(--bg-color));
            border: 1px solid var(--border-color);
            padding: 20px;
            border-radius: 20px;
            margin-bottom: 20px;
            line-height: 1.6;
            font-size: 12px;
            color: var(--text-secondary);
            border-left: 4px solid var(--accent-blue);
            box-shadow: 0 8px 20px var(--card-shadow);
            position: relative;
        }
        .rebalance-intro-modern b { color: var(--text-main); font-weight: 800; }
        
        .ri-icon {
            position: absolute; top: -12px; right: 20px;
            width: 32px; height: 32px;
            background: var(--card-bg);
            border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 10px var(--card-shadow);
            color: var(--accent-blue);
        }
        .ri-icon svg { width: 20px; height: 20px; stroke: currentColor; stroke-width: 2; fill: none; }

        .echelon-header-pill {
            background: rgba(255,255,255,0.8); backdrop-filter: blur(5px);
            color: #555; border: 1px solid rgba(0,0,0,0.1);
            border-radius: 50%; width: 24px; height: 24px;
            display: flex; align-items: center; justify-content: center;
            font-size: 10px; font-weight: 800; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            margin: 0 auto;
        }
        .dark-mode .echelon-header-pill { background: rgba(30,41,59,0.8); color: #ccc; border-color: rgba(255,255,255,0.1); }
        
        th:nth-child(1) .echelon-header-pill { color: #27ae60; border-color: #2ecc71; box-shadow: 0 2px 8px rgba(46, 204, 113, 0.2); }
        th:nth-child(2) .echelon-header-pill { color: #2980b9; border-color: #3498db; box-shadow: 0 2px 8px rgba(52, 152, 219, 0.2); }
        th:nth-child(3) .echelon-header-pill { color: var(--accent-yellow); border-color: var(--accent-yellow); box-shadow: 0 2px 8px rgba(241, 196, 15, 0.2); }
        th:nth-child(4) .echelon-header-pill { color: var(--accent-orange); border-color: var(--accent-orange); box-shadow: 0 2px 8px rgba(231, 76, 60, 0.2); }

        .echelon-table-styled { width: 100%; border-collapse: separate; border-spacing: 0; }
        .echelon-table-styled th { padding-bottom: 15px; vertical-align: bottom; }
        .echelon-table-styled td { padding: 12px 6px; border-bottom: 1px solid var(--item-border); text-align: center; vertical-align: middle; }
        .echelon-table-styled tr:last-child td { border-bottom: none; }
        .echelon-table-styled tr:nth-child(even) { background-color: rgba(0,0,0,0.015); }
        .dark-mode .echelon-table-styled tr:nth-child(even) { background-color: rgba(255,255,255,0.015); }
        
        .et-ticker { font-weight: 800; font-size: 11px; color: var(--text-main); display: block; margin-bottom: 4px; }
        .et-target {
            display: inline-block; font-size: 10px; font-weight: 700; color: var(--accent-green);
            background: rgba(46, 204, 113, 0.1); padding: 2px 6px; border-radius: 6px;
        }

        .echelon-wrapper {
            position: relative; border-radius: 16px; 
            padding: 20px 5px; overflow: hidden; 
            transition: max-height 0.4s ease;
        }
        .echelon-wrapper.collapsed { max-height: 240px; }
        
        #ofz-wrapper { padding: 0; }
        #ofz-wrapper.collapsed { max-height: 180px; }
        
        .echelon-wrapper.collapsed::after {
            content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 60px;
            background: linear-gradient(to bottom, transparent, var(--bg-color));
            pointer-events: none;
        }
        .expand-arrow-btn {
            display: flex; align-items: center; justify-content: center;
            width: 100%; padding: 0; margin-top: -16px; cursor: pointer;
            position: relative; z-index: 5; height: 32px;
        }
        #ofz-wrapper + .expand-arrow-btn { margin-top: 10px; }
        .eab-line { flex: 1; height: 1px; background: var(--item-border); }
        .eab-icon-box {
            width: 28px; height: 28px; border-radius: 50%; background: var(--card-bg);
            border: 1px solid var(--accent-blue); color: var(--accent-blue);
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05); transition: transform 0.3s;
        }
        .expand-arrow-btn:active .eab-icon-box { transform: scale(0.95); }
        .expand-arrow-btn.open .eab-icon-box { transform: rotate(180deg); }

        .portfolio-empty { padding: 40px 20px; text-align: center; color: var(--text-secondary); }
        .portfolio-empty-icon { font-size: 40px; margin-bottom: 15px; opacity: 0.5; }
        
        .summary-card {
            background: linear-gradient(135deg, var(--card-bg), #f8fafd);
            border-radius: 20px; padding: 20px; margin-bottom: 25px;
            box-shadow: 0 8px 25px var(--card-shadow); border: 1px solid var(--border-color);
            position: relative; overflow: hidden;
        }
        .dark-mode .summary-card { background: linear-gradient(135deg, var(--card-bg), #2c3a50); }

        .summary-card::before {
            content: ''; position: absolute; top: 0; right: 0; width: 100px; height: 100px;
            background: radial-gradient(circle, rgba(52,152,219,0.1) 0%, transparent 70%);
            border-radius: 50%; transform: translate(30%, -30%);
        }
        
        .summary-top-modern {
            padding-bottom: 15px; border-bottom: 1px dashed var(--item-border);
        }
        .stm-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
            margin-top: 10px;
        }
        .stm-header-label { font-size: 11px; color: #95a5a6; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
        .stm-val-big { font-size: 26px; font-weight: 800; color: var(--text-main); line-height: 1; }
        .stm-header-icon {
            width: 44px; height: 44px;
            border-radius: 14px;
            background: var(--coupon-blue-bg);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .stm-header-icon svg {
            width: 24px; height: 24px;
            stroke-width: 2;
            color: var(--accent-blue);
        }
        
        .stm-bar-container { display: flex; height: 8px; border-radius: 4px; overflow: hidden; background: #eee; width: 100%; }
        .dark-mode .stm-bar-container { background: rgba(0,0,0,0.2); }
        .stm-bar-bonds { background: var(--accent-blue); transition: width 0.3s; }
        .stm-bar-stocks { background: var(--accent-green); transition: width 0.3s; }
        
        .stm-meta-row { display: flex; justify-content: space-between; align-items: center; margin-top: 12px; }
        .stm-fee-lozenge { 
            font-size: 11px;
            color: var(--text-secondary);
            font-weight: 500;
            background: var(--bg-color);
            padding: 6px 12px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }
        .stm-pct-labels { display: flex; flex-direction: column; gap: 5px; font-size: 10px; font-weight: 700; }
        .stm-pl-bond { color: var(--accent-blue); }
        .stm-pl-stock { color: var(--accent-green); }
        
        .summary-prediction { background: rgba(46, 204, 113, 0.05); border-radius: 12px; padding: 12px; border: 1px solid rgba(46, 204, 113, 0.1); margin-top: 15px; }
        .dark-mode .summary-prediction { background: rgba(74, 222, 128, 0.05); border-color: rgba(74, 222, 128, 0.1); }
        .pred-title { font-size: 10px; color: #27ae60; font-weight: 700; text-transform: uppercase; margin-bottom: 4px; }
        .pred-total { font-size: 18px; font-weight: 800; color: #27ae60; margin-bottom: 8px; }
        .pred-breakdown { font-size: 11px; color: var(--text-main); }
        .pb-row { display: flex; justify-content: space-between; margin-bottom: 4px; }
        .dot-bond { color: var(--accent-blue); font-size: 10px; margin-right: 4px; }
        .dot-stock { color: var(--accent-green); font-size: 10px; margin-right: 4px; }
        
        .company-header { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }
        .back-btn { width: 36px; height: 36px; border-radius: 12px; background: var(--card-bg); display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1); cursor: pointer; color: var(--text-main); }
        .company-title { font-size: 20px; font-weight: 800; line-height: 1.2; }
        
        .company-card-v2 {
            background: var(--card-bg); border-radius: 20px; padding: 20px; 
            box-shadow: 0 8px 25px var(--card-shadow); border: 1px solid var(--border-color); 
            margin-bottom: 20px;
        }
        .cc-v2-header { display: flex; align-items: center; gap: 14px; margin-bottom: 20px; }
        .cc-v2-logo { 
            width: 48px; height: 48px; border-radius: 14px; background: var(--bg-color); 
            display: flex; align-items: center; justify-content: center; font-weight: 800;
            font-size: 12px; color: var(--text-secondary);
        }
        .cc-v2-name { font-size: 16px; font-weight: 800; color: var(--text-main); }
        .cc-v2-type { font-size: 11px; color: var(--text-secondary); text-transform: uppercase; font-weight: 600; }
        .cc-v2-price-block { display: flex; align-items: baseline; gap: 8px; margin-bottom: 15px; }
        .cc-v2-price { font-size: 34px; font-weight: 800; color: var(--text-main); }
        .cc-v2-change { font-size: 14px; font-weight: 700; }
        .cc-v2-change.positive { color: var(--accent-green); }
        .cc-v2-change.negative { color: var(--accent-red); }
        .cc-v2-change.neutral { color: var(--text-secondary); }
        
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .stat-item { background: var(--bg-color); border-radius: 12px; padding: 12px; }
        .stat-label { font-size: 10px; color: #8e8e93; text-transform: uppercase; margin-bottom: 4px; font-weight: bold; }
        .stat-val { font-size: 14px; font-weight: 800; color: var(--text-main); }
        
        .news-header { font-size: 16px; font-weight: 800; margin-bottom: 10px; }
        .news-item { background: var(--card-bg); border-radius: 16px; padding: 15px; margin-bottom: 10px; border: 1px solid var(--item-border); box-shadow: 0 4px 10px rgba(0,0,0,0.03); }
        .news-date { font-size: 10px; color: var(--accent-blue); font-weight: bold; margin-bottom: 4px; }
        .news-title { font-size: 13px; font-weight: bold; line-height: 1.4; margin-bottom: 6px; }
        .news-snippet { font-size: 11px; color: #8e8e93; line-height: 1.5; }
        
        .search-empty-state {
            text-align: center; padding: 40px 20px; color: var(--text-secondary);
        }
        .search-empty-state .icon { font-size: 48px; margin-bottom: 15px; opacity: 0.5; }
        .search-empty-state .title { font-size: 16px; font-weight: 700; margin-bottom: 8px; color: var(--text-main); }
        .search-empty-state .desc { font-size: 12px; line-height: 1.5; }

.echelon-table-styled td.et-cell {
    cursor: pointer;
    transition: background 0.2s;
    position: relative;
}

.echelon-table-styled td.et-cell:hover {
    background: rgba(52, 152, 219, 0.05);
}

.et-cell-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
}

.et-ticker {
    font-weight: 800;
    font-size: 12px;
    color: var(--text-main);
}

.et-price {
    font-size: 10px;
    color: var(--text-secondary);
}

.et-cell-empty {
    cursor: default !important;
}

.et-details-row td {
    padding: 0 !important;
    border: none !important;
    background: var(--bg-color);
}

.et-details-container {
    padding: 12px 20px;
}

.et-expanded-details {
    background: var(--card-bg);
    border-radius: 12px;
    padding: 16px;
    border: 1px solid var(--accent-blue);
    box-shadow: 0 4px 10px rgba(52, 152, 219, 0.1);
}

.et-details-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    padding-bottom: 8px;
    border-bottom: 1px solid var(--item-border);
}

.et-details-title {
    display: flex;
    align-items: center;
    gap: 12px;
}

.et-details-ticker {
    font-size: 16px;
    font-weight: 800;
    color: var(--text-main);
}

.et-details-echelon {
    font-size: 11px;
    font-weight: 700;
    padding: 3px 8px;
    border-radius: 6px;
    background: rgba(52, 152, 219, 0.1);
    color: var(--accent-blue);
    text-transform: uppercase;
}

.et-details-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 16px;
}

.et-detail-item {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.et-detail-label {
    font-size: 10px;
    color: var(--text-secondary);
    text-transform: uppercase;
    font-weight: 600;
}

.et-detail-value {
    font-size: 13px;
    color: var(--text-main);
    font-weight: 700;
}

.et-details-actions {
    display: flex;
    gap: 8px;
}

.et-btn-chart,
.et-btn-company {
    flex: 1;
    padding: 8px;
    border: none;
    border-radius: 8px;
    font-size: 11px;
    font-weight: 700;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    transition: all 0.2s;
}

.et-btn-chart {
    background: var(--accent-blue);
    color: white;
}

.et-btn-chart:hover {
    background: #2980b9;
}

.et-btn-company {
    background: var(--bg-color);
    color: var(--accent-blue);
    border: 1px solid var(--accent-blue);
}

.et-btn-company:hover {
    background: rgba(52, 152, 219, 0.1);
}

.et-btn-chart svg,
.et-btn-company svg {
    width: 14px;
    height: 14px;
    stroke: currentColor;
    fill: none;
    stroke-width: 2;
}

.asset-item .details {
    display: none !important;
}

.asset-item.is-expanded .details {
    display: block !important;
    animation: fadeIn 0.3s ease;
}

.asset-item {
    cursor: pointer;
}

.asset-item.is-expanded {
    background: rgba(52, 152, 219, 0.05);
}

        
        
    </style>
</head>
<body onclick="hideAllTips(event)">

<div id="toast" class="toast">Скопировано!</div>

    <div id="screen-home" class="screen active">
        <div class="terminal-header">
            <div class="terminal-badge">
                <span id="market-status-dot" class="market-dot"></span>
                <span>MADAME SOLOMI'NA: TERMINAL</span>
            </div>
            
            <div class="home-title">Добро Пожаловать! 🎉</div>
            <div class="home-desc">Это мини-помощник по выбору российских активов. Помогаем делать Иксы! 😁</div>
            
            <div class="info-card bonds">
               <div class="info-card-header">🛡️ Облигации</div>
                <div class="info-card-sub-clean">Ваш "Денежный Поток"</div>
                <div class="info-card-text">Это как дать в долг государству. Оно гарантирует возврат денег и платит проценты. Один из самых надежных способов сохранить деньги.</div>
                <div class="info-card-badge badge-blue">НАДЕЖНОСТЬ: ВЫСОКАЯ</div>
            </div>

            <div class="info-card stocks">
                <div class="info-card-header">🚀 Акции</div>
                <div class="info-card-sub-clean">Ваш "Двигатель Роста"</div>
                <div class="info-card-text">Вы становитесь совладельцем Сбера, Газпрома и других гигантов. Когда они зарабатывают и растут — растет и Ваш капитал.</div>
                <div class="info-card-badge badge-green">ДОХОДНОСТЬ: ВЫСОКАЯ</div>
            </div>
            
            <div id="start-calculation-block">
                <button class="btn-graphite" onclick="startCalculation()">
                    <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                    Начать расчет
                </button>
                <p class="start-expl">
                     Нажмите, чтобы перейти к вводу суммы и настройке параметров Вашего будущего Портфеля.
                </p>
            </div>
        </div>
    </div>

<!-- ================================ -->
<!-- НОВАЯ ВТОРАЯ ВКЛАДКА            -->
<!-- ================================ -->

<div id="screen-app" class="screen">
    <header class="terminal-header" style="padding: 45px 24px 30px 24px;">
        <div class="terminal-brand">Terminal</div>
        <div class="terminal-subtitle">Madame Solomi'na • Private Strategy</div>
    </header>

    <main style="padding-bottom: 200px;">
        
        <!-- Amount Section -->
        <section style="padding: 0 24px; margin-bottom: 40px;">
            <label style="font-size: 10px; font-weight: bold; color: #8e8e93; text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 16px; display: block;">Сумма к размещению</label>
            <div class="premium-input-container">
                <div class="amount-wrapper">
                    <input type="text" id="invest-amount-display" placeholder="0" class="premium-input" inputmode="numeric">
                    <span style="font-size: 30px; font-weight: 300; color: #d1d1d6; margin-left: 8px; margin-bottom: 4px;">₽</span>
                </div>
                <div class="amount-underline"></div>
            </div>
        </section>

        <!-- Custom Dropdown Section -->
        <section style="padding: 0 24px; margin-bottom: 40px;">
<label style="font-size: 10px; font-weight: bold; color: #8e8e93; text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 16px; display: block;">Тариф комиссии</label>
        <div class="custom-select-container">
            <div class="select-trigger" id="select-trigger">
                <span id="selected-value" style="font-weight: 600; color: #333D4D;">0.05% — Премиум (стандарт)</span>
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" style="color: #8e8e93;"><path d="m6 9 6 6 6-6"/></svg>
            </div>
            <div class="select-options" id="select-options">
                <div class="option-item" data-val="0.01">0.01% — Институциональный</div>
                <div class="option-item" data-val="0.03">0.03% — Премиум Плюс</div>
                <div class="option-item" data-val="0.05">0.05% — Премиум (стандарт)</div>
                <div class="option-item" data-val="0.1">0.1% — Трейдер</div>
                <div class="option-item" data-val="0.3">0.3% — Инвестор</div>
                <div class="option-item" data-val="0.5">0.5% — Стандарт</div>
            </div>
        </div>
    </section>

    <!-- Strategies Section -->
    <section style="padding: 0 24px;">
        <label style="font-size: 10px; font-weight: bold; color: #8e8e93; text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 24px; display: block;">Инвестиционная стратегия</label>
        <div id="strategy-grid"></div>
        
        <!-- Custom Ratio Control -->
        <div id="custom-ratio-controls" class="hidden" style="margin-top: 32px;">
            <div class="premium-slider-block fade-in-up">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 32px;">
                    <div>
                        <span style="font-size: 10px; font-weight: 900; text-transform: uppercase; color: #8e8e93; letter-spacing: 2px; display: block; margin-bottom: 4px;">Ручная настройка</span>
                        <h3 style="font-size: 20px; font-weight: bold; color: #333D4D; margin: 0;">Баланс активов</h3>
                    </div>
                    <button id="reset-slider" style="font-size: 10px; font-weight: bold; color: #8e8e93; text-transform: uppercase; border: 1px solid #e0e0e0; background: transparent; padding: 8px 16px; border-radius: 12px; cursor: pointer; transition: all 0.2s;">
                        Сброс 50/50
                    </button>
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                    <div style="text-align: left;">
                        <span id="custom-bonds-val-top" style="font-size: 30px; font-family: 'JetBrains Mono', monospace; font-weight: bold; color: #333D4D;">50%</span>
                        <span style="font-size: 9px; font-weight: 900; color: #8e8e93; display: block; letter-spacing: 2px;">ОБЛИГАЦИИ</span>
                    </div>
                    <div style="height: 40px; width: 1px; background: #e0e0e0;"></div>
                    <div style="text-align: right;">
                        <span id="custom-stocks-val-top" style="font-size: 30px; font-family: 'JetBrains Mono', monospace; font-weight: bold; color: #333D4D;">50%</span>
                        <span style="font-size: 9px; font-weight: 900; color: #8e8e93; display: block; letter-spacing: 2px;">АКЦИИ</span>
                    </div>
                </div>

                <input type="range" id="ratio-slider" min="0" max="100" value="50" style="margin-bottom: 16px;">
                
                <div style="display: flex; justify-content: space-between; font-size: 9px; font-weight: bold; color: #d1d1d6; text-transform: uppercase; letter-spacing: 2px;">
                    <span>Защита</span>
                    <span>Доходность</span>
                </div>
            </div>
        </div>
    </section>
</main>

<div class="bottom-sticky-panel">
    <button id="generate-btn" style="width: 100%; background: #333D4D; color: white; padding: 20px; border-radius: 20px; font-weight: 900; font-size: 17px; border: none; cursor: pointer; box-shadow: 0 12px 25px rgba(48, 61, 79, 0.3); transition: all 0.2s;">
        Сформировать портфель
    </button>
    <p style="font-size: 10px; text-align: center; color: #8e8e93; margin-top: 20px; line-height: 1.6; font-weight: 500; opacity: 0.6; padding: 0 8px;">
         Madame Solomi'na предложит вам 8 ОФЗ и 12 ликвидных акций на основе выбранного риска.
    </p>
</div>
<span class="et-details-ticker">${asset.t}</span>
                    <span class="et-details-echelon">${echelonName}</span>
                </div>
            </div>
           <div style="margin-bottom: 16px;">
<div style="background: linear-gradient(135deg, var(--bg-color), var(--card-bg)); padding: 16px; border-radius: 16px; border: 1px solid var(--border-color); margin-bottom: 12px; box-shadow: 0 2px 8px var(--card-shadow);">
    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
        <div style="font-size: 10px; color: var(--text-secondary); text-transform: uppercase; font-weight: 600; letter-spacing: 0.5px;">Компания</div>
        <div style="background: var(--accent-blue); color: white; font-size: 9px; font-weight: 700; padding: 4px 10px; border-radius: 8px; text-transform: uppercase; letter-spacing: 0.5px;">${echelonName}</div>
    </div>
    <div style="font-size: 16px; font-weight: 800; color: var(--text-main); line-height: 1.4; margin-bottom: 8px;">${companyName}</div>
    ${asset.sector ? `<div style="display: inline-flex; align-items: center; gap: 6px; background: rgba(52, 152, 219, 0.1); color: var(--accent-blue); font-size: 11px; font-weight: 600; padding: 6px 12px; border-radius: 8px; margin-top: 4px;">
        <svg style="width: 14px; height: 14px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
        ${asset.sector}
    </div>` : ''}
</div>

<div class="et-details-grid">
    <div class="et-detail-item">
        <span class="et-detail-label">Тикер:</span>
        <span class="et-detail-value" style="cursor:pointer; color:var(--accent-blue);" onclick="copyTicker(event, '${asset.t}')">${asset.t} 📋</span>
    </div>
    <div class="et-detail-item">
        <span class="et-detail-label">Цель:</span>
        <span class="et-detail-value">${asset.target}</span>
    </div>
    <div class="et-detail-item">
        <span class="et-detail-label">Прогноз:</span>
        <span class="et-detail-value">до 36 мес.</span>
    </div>
</div>
window.scrollTo({
    top: offsetPosition,
    behavior: 'smooth'
});
} else {
    detailsRow.style.display = 'none';
}
for(let e of echelons) {
    const found = e.assets.find(a => a.t === ticker);
    if(found) {
        foundAsset = found;
        break;
    }
}

if(!foundAsset) {
    for(let i = 0; i < echelonTableData.length; i++) {
        const found = echelonTableData[i].find(a => a.t === ticker);
        if(found) {
            foundAsset = {
                t: found.t,
                n: companyName || found.t,
                p: 0,
                target: found.target
            };
            break;
        }
    }
}

if(foundAsset) {
    const item = {
        ...foundAsset,
        type: 'Акция'
    };
    openCompanyPage(item);
}
function renderOfzList() {
if (bonds.length === 0) return;

let ofzHtml = '';
bonds.forEach(b => {
    const details = bondDetailsMap[b.t] || { matDate:'—', couponValue:0, nextCoupon:'—', couponYield:'—', freq:0 };
    const calculatedCY = (b.p > 0 && details.couponValue && details.freq) ? ((details.couponValue * details.freq) / b.p * 100).toFixed(2) : '0.00';
    ofzHtml += `
    <div class="ofz-card-modern" onclick="toggleOfzDetails('details-${b.t}')">
        <div class="ofz-main-info">
            <div class="ofz-name-lg">${limitName(b.n)}</div>
            <div class="ofz-ticker-sm">${b.t}</div>
        </div>
        <div class="ofz-price">${b.p}</div>
        <div class="ofz-nkd-badge">${Math.round(b.nkd*10)/10}</div>
        <div class="ofz-yield-badge" title="Доходность к погашению">
            ${b.y} <svg class="ofz-arrow" viewBox="0 0 24 24"><path d="M7 17l9.2-9.2M17 17V7H7"/></svg>
        </div>
    </div>
    <div id="details-${b.t}" class="ofz-details-panel">
        <div class="ofz-detail-row"><span>Код:</span> <span class="ofz-detail-val">${b.t}</span></div>
        <div class="ofz-detail-row"><span>НКД:</span> <span class="ofz-detail-val">${b.nkd.toFixed(2)} ₽</span></div>
        <div class="ofz-detail-row"><span>Дата погашения:</span> <span class="ofz-detail-val">${details.matDate}</span></div>
        <div class="ofz-detail-row"><span>Размер купона:</span> <span class="ofz-detail-val">${details.couponValue} ₽</span></div>
        <div class="ofz-detail-row"><span>Дата ближайшего купона:</span> <span class="ofz-detail-val">${details.nextCoupon}</span></div>
        <div class="ofz-detail-row"><span>Текущая купонная доходность:</span> <span class="ofz-detail-val">${calculatedCY}%</span></div>
        <div class="ofz-detail-row"><span>Выплат в год:</span> <span class="ofz-detail-val">${details.freq}</span></div>
    </div>`;
});
if(document.getElementById('ofz-list')) {
    document.getElementById('ofz-list').innerHTML = ofzHtml;
}
async function fetchBondDetailsInBackground() {
const promises = bonds.map(async (b) => {
    try {
        const extra = await fetchBondData(b.t);
        b.nkd = extra.nkd || 0;
        b.matDate = extra.matDate || '—';
    } catch(e) {
        console.log("Error fetching", b.t);
    }
});

await Promise.all(promises);

renderOfzList();
draw();
function performSearch(query) {
        if(!query || query.length < 2) {
            openCompanyPage(null, query);
            return;
        }
        
        const q = query.toUpperCase();
        let results = [];
        echelons.forEach(e => {
            e.assets.forEach(a => {
                if(a.t.toUpperCase().includes(q) || a.n.toUpperCase().includes(q)) results.push({...a, type: 'Акция'});
            });
        });
        bonds.forEach(b => {
            if(b.t.toUpperCase().includes(q) || b.n.toUpperCase().includes(q)) results.push({...b, type: 'Облигация'});
        });
        
        const input = document.getElementById('tickerSearchInput');
        input.value = '';
        input.blur();
        
        openCompanyPage(results[0] || null, query);
    }
    
    async function openCompanyPage(item, searchQuery = '') {
        const content = document.getElementById('company-content');
        
        if(!item) {
            content.innerHTML = `
                <div class="search-empty-state">
                    <div class="icon">🔍</div>
                    <div class="title">Ничего не найдено</div>
                    <div class="desc">По запросу "${searchQuery}" не найдено результатов.<br>Попробуйте изменить запрос.</div>
                </div>
            `;
            showScreen('screen-company');
            return;
        }
        
        const isStock = item.type === 'Акция';
        const target = isStock ? item.target : '-';
        const yieldVal = isStock ? 'СМ. ТАБЛИЦУ' : item.y;
        
        let changeHtml = '<div class="cc-v2-change neutral">--</div>';
        
        try {
            const url = `https://iss.moex.com/iss/engines/stock/markets/${isStock ? 'shares' : 'bonds'}/securities/${item.t}.json?iss.meta=off&iss.only=securities,marketdata`;
            const res = await fetch(url);
            const data = await res.json();
            const marketdata = data.marketdata.data[0];
            const marketcols = data.marketdata.columns;
            const last = marketdata[marketcols.indexOf('LAST')];
            const open = marketdata[marketcols.indexOf('OPEN')];
            
            if (last && open && open > 0) {
                const change = last - open;
                const changePct = (change / open) * 100;
                const sign = change > 0 ? '+' : '';
                const colorClass = change > 0 ? 'positive' : (change < 0 ? 'negative' : 'neutral');
                changeHtml = `<div class="cc-v2-change ${colorClass}">${sign}${change.toFixed(2)} (${sign}${changePct.toFixed(2)}%)</div>`;
            }
        } catch (e) { console.log('Error fetching company details'); }

        let html = `
            <div class="company-card-v2">
                <div class="cc-v2-header">
                    <div class="cc-v2-logo">${item.t}</div>
                    <div>
                        <div class="cc-v2-name">${item.n}</div>
                        <div class="cc-v2-type">${item.type}</div>
                    </div>
                </div>
                <div class="cc-v2-price-block">
                     <div class="cc-v2-price">${item.p} ₽</div>
                     ${changeHtml}
                </div>
                <button class="btn-action" onclick="openTradingView(event, '${item.t}')">Открыть график TradingView</button>
            </div>
            
            <div class="news-header">Характеристики</div>
            <div class="stat-grid">
                 <div class="stat-item">
                    <div class="stat-label">${isStock ? 'Цель' : 'Доходность'}</div>
                    <div class="stat-val" style="color:var(--accent-green)">${isStock ? target : yieldVal}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Эшелон</div>
                    <div class="stat-val">${isStock ? (echelons.findIndex(e => e.assets.some(a => a.t === item.t)) + 1) : 'N/A'}</div>
                </div>
            </div>
            
            <div class="news-header">Новости компании</div>
            <div id="company-news-list">
                <div class="news-item">
                     <div class="news-date">Сегодня</div>
                     <div class="news-title">Обзор рыночной ситуации по ${item.t}</div>
                     <div class="news-snippet">Аналитики отмечают стабильное положение компании на рынке. Технический анализ показывает консолидацию цены...</div>
                </div>
                 <div class="news-item">
                     <div class="news-date">Вчера</div>
                     <div class="news-title">Финансовые показатели</div>
                     <div class="news-snippet">Компания опубликовала отчетность за последний квартал. Выручка соответствует ожиданиям экспертов...</div>
                </div>
            </div>
        `;
        content.innerHTML = html;
        showScreen('screen-company');
    }

    function draw() {
        saveSettings();
        
        // Получаем сумму из нового поля или старого
        let inputSum = 0;
        if(amountInput && amountInput.value) {
            inputSum = parseFloat(amountInput.value.replace(/\./g, '')) || 0;
        } else {
            inputSum = parseFloat(document.getElementById('sumInput').value) || 0;
        }
        
        // Определяем соотношение
        let bondPct = 50;
        if(selectedId === 'custom') {
            bondPct = customBonds;
        } else {
            const strategy = strategies.find(s => s.id === selectedId);
            if(strategy) bondPct = strategy.bonds;
        }
        
        const stockPct = 100 - bondPct;
        
        // Синхронизируем старый слайдер
        const oldSlider = document.getElementById('ratioSlider');
        if(oldSlider) oldSlider.value = bondPct;
        
        const bondBudget = (inputSum * bondPct) / 100;
        const stockBudget = (inputSum * stockPct) / 100;
        const feeVal = inputSum * brokerFee;

        if(document.getElementById('labelBondsPct')) {
            document.getElementById('labelBondsPct').innerText = bondPct;
            document.getElementById('labelStocksPct').innerText = stockPct;
            document.getElementById('dynamicSubtitle').innerText = `Система ${bondPct}/${stockPct}: Денежный Поток и Рост.`;
            document.querySelectorAll('.bond-pct-text').forEach(el => el.innerText = bondPct);
            document.querySelectorAll('.stock-pct-text').forEach(el => el.innerText = stockPct);
            document.getElementById('mainChart').style.background = `conic-gradient(var(--accent-blue) 0% ${bondPct}%, var(--accent-green) ${bondPct}% 100%)`;
            document.getElementById('mainChart').setAttribute('data-pct', `${bondPct}/${stockPct}`);
        }

        const bondSection = document.getElementById('section-bonds');
        const couponBox = document.getElementById('couponBox');
        const separator = document.getElementById('section-separator');
        const stockSection = document.getElementById('section-stocks');
        const stockHeader = document.getElementById('header-stocks');
        const footerImportant = document.getElementById('footer-important');
        
        if(bondSection && stockSection) {
            bondSection.style.display = 'block'; couponBox.style.display = 'block';
            separator.style.display = 'flex'; stockSection.style.display = 'block';
            footerImportant.style.display = 'block'; stockHeader.innerText = "2. Растущая часть";
            if (bondPct === 0) {
                bondSection.style.display = 'none'; couponBox.style.display = 'none';
                separator.style.display = 'none'; stockHeader.innerText = "1. Растущая часть";
            } else if (bondPct === 100) {
                stockSection.style.display = 'none'; footerImportant.style.display = 'none';
                separator.style.display = 'none';
            }
        }

        let actualSpentTotal = 0; let bondQuantities = {};
        let totalBondProjectedIncome = 0;
        let rainData = [];
        
        let bHtml = '';
        if (bonds.length > 0) {
            const perBondBudget = bondBudget / bonds.length;
            let bondCalculations = bonds.map(b => { const fullCostPerUnit = (b.p + b.nkd) * (1 + brokerFee); let qty = fullCostPerUnit > 0 ? Math.floor(perBondBudget / fullCostPerUnit) : 0; return { ...b, qty, fullCostPerUnit }; });
            let leftover = bondBudget - bondCalculations.reduce((acc, b) => acc + (b.qty * b.fullCostPerUnit), 0);
            if (bondCalculations.length > 0 && leftover >= bondCalculations[0].fullCostPerUnit && bondCalculations[0].fullCostPerUnit > 0) {
                bondCalculations[0].qty += Math.floor(leftover / bondCalculations[0].fullCostPerUnit);
            }
            bondCalculations.forEach(b => {
                actualSpentTotal += (b.qty * b.fullCostPerUnit); bondQuantities[b.t] = b.qty;
                const bondYieldVal = parseFloat(b.y.replace('%', '')) || 0;
                const investedInBond = b.qty * b.p;
                totalBondProjectedIncome += (investedInBond * (bondYieldVal / 100) * 3);
                if(b.qty > 0 && bondCouponsMap[b.t]) {
                     const info = bondCouponsMap[b.t];
                     const netAmount = (info.value * b.qty) * (1 - currentTax);
                     rainData.push({ date: info.date, name: b.n, qty: b.qty, amount: netAmount });
                }
                bHtml += `
                <div class="asset-item" onclick="toggleRow(this)">
                    <span class="ticker" style="font-weight:700; font-size:11px;">${limitName(b.n)}</span>
                    <span class="asset-name"><span class="asset-yield-badge">${b.y}</span></span>
                    <span class="qty">${b.qty} шт.</span>
                    <span class="price-total">${Math.round(b.qty * b.p).toLocaleString()} ₽</span>
                    <div class="details">
                        <div class="detail-row"><span>Полное Наименование:</span> <span>${b.n}</span></div>
                        <div class="detail-row"><span>Код:</span> <span>${b.t}</span></div>
                        <div class="detail-row"><span>Дата погашения:</span> <span>${b.matDate}</span></div>
                        <div class="detail-row"><span>Цена:</span> <span>${b.p} ₽</span></div>
                        <div class="detail-row"><span>НКД:</span> <span>${b.nkd.toFixed(2)} ₽</span></div>
                        <div class="detail-row"><span>Простая Доходность к Погашению:</span> <span>${b.y.replace(' ₽','')}</span></div>
                        <button class="btn-tiny-graph" onclick="openTradingView(event, '${b.t}')">
                            <svg style="width:12px;height:12px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3v18h18"/><path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/></svg>
                            Открыть график
                        </button>
                    </div>
                </div>`;
            });
        }
        if(document.getElementById('listBonds')) { document.getElementById('listBonds').innerHTML = bHtml;
        document.getElementById('valBonds').innerText = Math.round(bondBudget).toLocaleString(); }
        
        if(document.getElementById('couponList')) {
            rainData.sort((a,b) => new Date(a.date) - new Date(b.date));
            let couponHtml = ''; let couponTotal = 0;
            if(rainData.length === 0) { 
                couponHtml = '<div style="text-align:center; padding:15px; color:#aaa; font-size:12px;">Нет ближайших выплат для выбранных активов.</div>';
            } else { 
                rainData.forEach(r => { 
                    couponTotal += r.amount; 
                    couponHtml += `
                    <div class="coupon-row">
                        <div><b>${new Date(r.date).toLocaleDateString('ru-RU')}</b></div>
                        <div style="color:#8e8e93">${limitName(r.name)}</div>
                        <div style="text-align:center">${r.qty}шт.</div>
                        <div style="text-align:right"><b>${Math.round(r.amount).toLocaleString()}₽</b></div>
                    </div>`; 
                }); 
            }
            document.getElementById('couponList').innerHTML = couponHtml;
            document.getElementById('couponTotalHeader').innerText = Math.round(couponTotal).toLocaleString() + ' ₽';
        }
        
        let ofzHtml = '';
        bonds.forEach(b => {
            const details = bondDetailsMap[b.t] || { matDate:'—', couponValue:0, nextCoupon:'—', couponYield:'—', freq:0 };
            const calculatedCY = (b.p > 0 && details.couponValue && details.freq) ? ((details.couponValue * details.freq) / b.p * 100).toFixed(2) : '0.00';
            ofzHtml += `
            <div class="ofz-card-modern" onclick="toggleOfzDetails('details-${b.t}')">
                <div class="ofz-main-info">
                    <div class="ofz-name-lg">${limitName(b.n)}</div>
                    <div class="ofz-ticker-sm">${b.t}</div>
                </div>
                <div class="ofz-price">${b.p}</div>
                <div class="ofz-nkd-badge">${Math.round(b.nkd*10)/10}</div>
                <div class="ofz-yield-badge" title="Доходность к погашению">
                    ${b.y} <svg class="ofz-arrow" viewBox="0 0 24 24"><path d="M7 17l9.2-9.2M17 17V7H7"/></svg>
                </div>
            </div>
            <div id="details-${b.t}" class="ofz-details-panel">
                <div class="ofz-detail-row"><span>Код:</span> <span class="ofz-detail-val">${b.t}</span></div>
                <div class="ofz-detail-row"><span>НКД:</span> <span class="ofz-detail-val">${b.nkd.toFixed(2)} ₽</span></div>
                <div class="ofz-detail-row"><span>Дата погашения:</span> <span class="ofz-detail-val">${details.matDate}</span></div>
                <div class="ofz-detail-row"><span>Размер купона:</span> <span class="ofz-detail-val">${details.couponValue} ₽</span></div>
                <div class="ofz-detail-row"><span>Дата ближайшего купона:</span> <span class="ofz-detail-val">${details.nextCoupon}</span></div>
                <div class="ofz-detail-row"><span>Текущая купонная доходность:</span> <span class="ofz-detail-val">${calculatedCY}%</span></div>
                <div class="ofz-detail-row"><span>Выплат в год:</span> <span class="ofz-detail-val">${details.freq}</span></div>
            </div>`;
        });
        if(document.getElementById('ofz-list')) document.getElementById('ofz-list').innerHTML = ofzHtml;

        let eHtml = '';
        let totalStockProjectedGrowth = 0;
        let echelonIndex = 0;
        echelons.forEach(e => {
            const echelonBudget = stockBudget * e.weight; const perAssetBudget = e.assets.length > 0 ? echelonBudget / e.assets.length : 0;
            let stockCalculations = e.assets.map(a => { const fullCostPerUnit = a.p * (1 + brokerFee); let qty = fullCostPerUnit > 0 ? Math.floor(perAssetBudget / fullCostPerUnit) : 0; return { ...a, qty, fullCostPerUnit }; });
            let currentEchelonSpent = stockCalculations.reduce((acc, s) => acc + (s.qty * s.fullCostPerUnit), 0);
            if (stockCalculations.length > 0 && (echelonBudget - currentEchelonSpent) >= stockCalculations[0].fullCostPerUnit) {
                stockCalculations[0].qty += Math.floor((echelonBudget - currentEchelonSpent) / stockCalculations[0].fullCostPerUnit);
            }
            const tipId = `echelon-tip-${echelonIndex}`;
            const echelonClass = `echelon-${echelonIndex + 1}`;
            eHtml += `
            <div class="echelon-separator-modern ${echelonClass}">
                <div class="esm-left">
                    <div class="esm-dot"></div>
                    <span class="esm-title">${e.title}</span>
                    <div class="esm-info-btn-light" onclick="toggleEchelonTip(event, '${tipId}')">
                         <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
                    </div>
                </div>
                <div class="esm-pct">
                    <span class="esm-sum">${Math.round(echelonBudget).toLocaleString()} ₽</span>
                    <span class="esm-divider">|</span>
                    <span class="esm-percent">${Math.round(e.weight*100)}%</span>
                </div>
            </div>
            <div class="echelon-tip" id="${tipId}">${e.info}</div>
            <div class="asset-list">`;
            stockCalculations.forEach(s => {
                actualSpentTotal += (s.qty * s.fullCostPerUnit);
                const targetPrice = parseFloat(s.target.replace(/[^\d.]/g,'')) || s.p;
                if(targetPrice > s.p) totalStockProjectedGrowth += (s.qty * (targetPrice - s.p));
                eHtml += `
                <div class="asset-item" onclick="toggleRow(this)">
                    <span class="ticker">${s.t}</span>
                    <span class="asset-name"><span class="asset-yield-badge blue">${s.target.replace(' ₽','')}</span></span>
                    <span class="qty">${s.qty} шт.</span>
                    <span class="price-total">${Math.round(s.qty*s.p).toLocaleString()} ₽</span>
                    <div class="details">
                        <div class="detail-row"><span>Компания:</span> <span>${s.n}</span></div>
                        <div class="detail-row"><span>Тикер:</span> <span style="cursor:pointer; color:var(--accent-blue); font-weight:bold;" onclick="copyTicker(event, '${s.t}')">${s.t} ❐</span></div>
                        <div class="detail-row"><span>Цена:</span> <span>${s.p} ₽</span></div>
                        <div class="detail-row"><span>Цель:</span> <span>${s.target.replace(' ₽','')}</span></div>
                        <div style="font-size:10px; color:#aaa; margin:5px 0 8px;">[ Прогноз на период до 36 мес. ]</div>
                        <button class="btn-tiny-graph" onclick="openTradingView(event, '${s.t}')">
                            <svg style="width:12px;height:12px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3v18h18"/><path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/></svg>
                            Открыть график
                        </button>
                    </div>
                </div>`;
            });
            eHtml += `</div>`;
            echelonIndex++;
        });
        if(document.getElementById('echelonContainer')) {
            document.getElementById('echelonContainer').innerHTML = eHtml;
            document.getElementById('valStocks').innerText = Math.round(stockBudget).toLocaleString();
            document.getElementById('usageFill').style.width = Math.min((actualSpentTotal / inputSum) * 100, 100) + '%';
            document.getElementById('usageLabelText').innerText = Math.round(actualSpentTotal).toLocaleString() + ' ₽';
            document.getElementById('summ-invested').innerText = Math.round(inputSum).toLocaleString() + ' ₽';
            document.getElementById('srl-bond-pct').innerText = bondPct + '%';
            document.getElementById('srl-stock-pct').innerText = stockPct + '%';
            document.getElementById('bar-bond-fill').style.width = bondPct + '%';
            document.getElementById('bar-stock-fill').style.width = stockPct + '%';
            const activeFeeBtn = document.querySelector('.fee-btn.active');
            document.getElementById('summ-fee').innerText = activeFeeBtn ? activeFeeBtn.innerText : '0.03%';
            document.getElementById('summ-bond-income').innerText = '+' + Math.round(totalBondProjectedIncome).toLocaleString() + ' ₽';
            document.getElementById('summ-stock-growth').innerText = '+' + Math.round(totalStockProjectedGrowth).toLocaleString() + ' ₽';
            const projectedTotal = inputSum + totalBondProjectedIncome + totalStockProjectedGrowth - feeVal;
            let percentageChange = (inputSum > 0) ? ((projectedTotal - inputSum) / inputSum) * 100 : 0;
            const changeSign = percentageChange >= 0 ? '+' : '';
            const changeColor = percentageChange >= 0 ? '#27ae60' : '#e74c3c';
            const changeHtml = ` <span style="font-size: 14px; color: ${changeColor}; font-weight: 500;">(${changeSign}${percentageChange.toFixed(1)}%)</span>`;
            document.getElementById('summ-total-3y').innerHTML = Math.round(projectedTotal).toLocaleString() + ' ₽' + changeHtml;
        }
        updateEchelonTable();
    }

    async function shareAsPDF() {
        const btn = document.getElementById('btnShare');
        const container = document.getElementById('shareContainer');
        const brand = document.getElementById('shareBrand'); 
        const dateEl = document.getElementById('shareDate');
        const originalText = btn.innerHTML;
        btn.innerText = "⏳ Генерация PDF..."; btn.disabled = true; 
        brand.style.display = 'block'; dateEl.innerText = new Date().toLocaleString();
        try {
            const canvas = await html2canvas(container, { backgroundColor: getComputedStyle(document.body).getPropertyValue('--bg-color'), scale: 2, logging: false, useCORS: true });
            const imgData = canvas.toDataURL('image/png');
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({ orientation: 'p', unit: 'px', format: [canvas.width, canvas.height] });
            doc.addImage(imgData, 'PNG', 0, 0, canvas.width, canvas.height);
            const pdfBlob = doc.output('blob');
            if (navigator.share && navigator.canShare) {
                const file = new File([pdfBlob], "Madame_Solomina_Portfolio.pdf", { type: "application/pdf" });
                if (navigator.canShare({ files: [file] })) {
                    await navigator.share({ files: [file], title: 'Мой портфель', text: 'Расчет от Madame Solomi\'na' });
                    btn.innerHTML = originalText; btn.disabled = false; brand.style.display = 'none'; return;
                }
            }
            doc.save('Solomina_Portfolio.pdf');
            setTimeout(() => { btn.innerHTML = `✅ Файл скачан`; setTimeout(() => { btn.innerHTML = originalText; btn.disabled = false; }, 2000); }, 500);
        } catch(e) {
            console.error(e); alert("Не удалось открыть меню отправки. Файл будет скачан.");
            btn.innerHTML = originalText; btn.disabled = false;
        } finally { brand.style.display = 'none'; }
    }

    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('./service-worker.js')
            .then(function(registration) {
                console.log('Service Worker зарегистрирован:', registration);
            })
            .catch(function(error) {
                console.log('Ошибка регистрации Service Worker:', error);
            });
    }


    loadData(); 
    if(window.Telegram && window.Telegram.WebApp) {
        window.Telegram.WebApp.ready(); 
        window.Telegram.WebApp.expand();
        window.Telegram.WebApp.disableVerticalSwipes();
    }
</script>
